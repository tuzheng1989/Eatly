import{i as M}from"./charts-BcJttBv9.js";import{k as G,r as f,o as N,w as T,L as p,M as C,N as h,O as c,R as i,P as y,Q as _,F as $,Z as O,j as Y,Y as b}from"./vue-vendor-Bi-VIAV2.js";import{f as q,s as j,t as F,v as k,c as D,w as m,p as R,m as I,i as L}from"./ui-library-BNKiWr2G.js";import{d as V,_ as S}from"./index-C6H1Hdn7.js";import{r as P}from"./record.service-BTSfs8Wh.js";class z{async calculateOverview(u){const t=u.length,a={A:0,B:0,C:0},l=new Map;u.forEach(e=>{Object.entries(e.meals).forEach(([n,s])=>{a[n]++;const v=`${n}-${s}`,d=l.get(v)||{count:0,group:n};l.set(v,{count:d.count+1,group:d.group})})});const o=Array.from(l.entries()).sort((e,n)=>n[1].count-e[1].count).slice(0,5).map(([e,n])=>({name:e.split("-")[1],group:n.group,count:n.count}));return{totalDays:t,totalRecords:t,mealsByGroup:a,topDishes:o}}async calculateFrequency(u){const t={A:0,B:0,C:0},a=new Map;let l=0;u.forEach(e=>{Object.entries(e.meals).forEach(([n,s])=>{t[n]++,l++;const v=a.get(s);v?v.count++:a.set(s,{name:s,group:n,count:1})})});const o=Array.from(a.values()).map(e=>({...e,percentage:e.count/l*100}));return{byGroup:t,byDish:o}}async calculateTrends(u,t){const a=new Map;u.forEach(o=>{let e;const n=V(o.date);switch(t){case"day":e=o.date;break;case"week":e=n.startOf("week").format("YYYY-MM-DD");break;case"month":e=n.format("YYYY-MM");break}const s=a.get(e)||[];s.push(o),a.set(e,s)});const l=Array.from(a.entries()).map(([o,e])=>{const n={A:0,B:0,C:0},s=new Set;return e.forEach(v=>{Object.entries(v.meals).forEach(([d,r])=>{n[d]++,s.add(`${d}-${r}`)})}),{date:o,totalMeals:e.length*3,uniqueDishes:s.size,breakdown:n}}).sort((o,e)=>o.date.localeCompare(e.date));return{timeGranularity:t,intakeTrend:l,diversityTrend:l}}async generateStatistics(u="week"){const t=await P.getAll(),[a,l,o]=await Promise.all([this.calculateOverview(t),this.calculateFrequency(t),this.calculateTrends(t,u)]);return{overview:a,frequency:l,trends:o}}}const Q=new z,U={class:"trend-chart"},Z={class:"chart-header"},H=G({__name:"TrendChart",props:{data:{},granularity:{}},emits:["granularity-change"],setup(g,{emit:u}){const t=g,a=u,l=f(),o=f(t.granularity),e=f(),n=[{label:"æ—¥",value:"day"},{label:"å‘¨",value:"week"},{label:"æœˆ",value:"month"}];N(()=>{l.value&&(e.value=M(l.value),s())}),T(()=>t.data,s,{deep:!0});function s(){if(!e.value)return;const d={title:{text:"é¥®é£Ÿæ‘„å…¥è¶‹åŠ¿"},tooltip:{trigger:"axis",formatter:r=>{if(!Array.isArray(r)||r.length===0)return"";let A=`<strong>${r[0].axisValue}</strong><br/>`;return r.forEach(w=>{const x=w.value,E=typeof x=="number"?x:0;A+=`${w.marker} ${w.seriesName}: ${E} ä¸ª<br/>`}),A}},legend:{data:["Aç»„","Bç»„","Cç»„"]},xAxis:{type:"category",data:t.data.map(r=>r.date)},yAxis:{type:"value",name:"èœå“æ•°é‡"},series:[{name:"Aç»„",type:"line",data:t.data.map(r=>r.breakdown.A)},{name:"Bç»„",type:"line",data:t.data.map(r=>r.breakdown.B)},{name:"Cç»„",type:"line",data:t.data.map(r=>r.breakdown.C)}]};e.value.setOption(d)}function v(d){a("granularity-change",d)}return(d,r)=>(p(),C("div",U,[h("div",Z,[r[1]||(r[1]=h("h3",null,"é¥®é£Ÿæ‘„å…¥è¶‹åŠ¿",-1)),c(i(q),{value:o.value,"onUpdate:value":[r[0]||(r[0]=B=>o.value=B),v],options:n},null,8,["value"])]),h("div",{ref_key:"chartRef",ref:l,class:"chart-container"},null,512)]))}}),J=S(H,[["__scopeId","data-v-ec8c4af3"]]),K={class:"statistics"},W=G({__name:"Statistics",setup(g){const u=f(!1),t=f("week"),a=f({overview:{totalDays:0,totalRecords:0,mealsByGroup:{A:0,B:0,C:0},topDishes:[]},frequency:{byGroup:{A:0,B:0,C:0},byDish:[]},trends:{timeGranularity:"week",intakeTrend:[],diversityTrend:[]}});async function l(){u.value=!0;try{a.value=await Q.generateStatistics(t.value)}finally{u.value=!1}}function o(e){t.value=e,l()}return N(async()=>{await l()}),(e,n)=>(p(),C("div",K,[n[0]||(n[0]=h("h1",null,"ç»Ÿè®¡åˆ†æž ðŸ“Š",-1)),c(i(j),{show:u.value},{default:y(()=>[c(i(F),{cols:1,"x-gap":16,"y-gap":16},{default:y(()=>[c(i(k),null,{default:y(()=>[c(i(D),{title:"æ¦‚è§ˆ"},{default:y(()=>[c(i(m),{label:"æ€»è®°å½•å¤©æ•°",value:a.value.overview.totalDays},null,8,["value"]),c(i(m),{label:"Aç»„èœå“",value:a.value.overview.mealsByGroup.A},null,8,["value"]),c(i(m),{label:"Bç»„èœå“",value:a.value.overview.mealsByGroup.B},null,8,["value"]),c(i(m),{label:"Cç»„èœå“",value:a.value.overview.mealsByGroup.C},null,8,["value"])]),_:1})]),_:1}),c(i(k),null,{default:y(()=>[c(i(D),{title:"çƒ­é—¨èœå“"},{default:y(()=>[a.value.overview.topDishes.length>0?(p(),_(i(I),{key:0},{default:y(()=>[(p(!0),C($,null,O(a.value.overview.topDishes,s=>(p(),_(i(R),{key:s.name},{default:y(()=>[Y(b(s.name)+" ("+b(s.group)+"ç»„) - "+b(s.count)+"æ¬¡ ",1)]),_:2},1024))),128))]),_:1})):(p(),_(i(L),{key:1,description:"æš‚æ— æ•°æ®"}))]),_:1})]),_:1}),c(i(k),null,{default:y(()=>[c(J,{data:a.value.trends.intakeTrend,granularity:t.value,onGranularityChange:o},null,8,["data","granularity"])]),_:1})]),_:1})]),_:1},8,["show"])]))}}),se=S(W,[["__scopeId","data-v-4b59229b"]]);export{se as default};
