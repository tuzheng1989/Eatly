import{k as F,$ as Y,r as b,o as L,M as k,N as i,R as l,Q as m,P as u,O as s,L as r,j as v,Y as p,F as D,_ as C,Z as j,c as O}from"./vue-vendor-Bi-VIAV2.js";import{u as h,d as U,_ as E}from"./index-C6H1Hdn7.js";import{u as P}from"./record-DshWbak5.js";import{j as V,k as T,l as _,m as z,i as Q,d as f,n as Z,f as N,g,o as G,B as w,p as H}from"./ui-library-BNKiWr2G.js";import"./record.service-BTSfs8Wh.js";const J={class:"record"},K={class:"record-item"},W={class:"date"},X={class:"meals"},ee=F({__name:"Record",setup(le){const y=P(),{records:M,loading:x}=Y(y),R=h(),{currentScheme:n}=Y(R),B=b(),I={date:[{required:!0,message:"è¯·é€‰æ‹©æ—¥æœŸ",trigger:"blur"}],"meals.A":[{required:!0,message:"è¯·é€‰æ‹©Aç»„èœå“",trigger:"change"}],"meals.B":[{required:!0,message:"è¯·é€‰æ‹©Bç»„èœå“",trigger:"change"}],"meals.C":[{required:!0,message:"è¯·é€‰æ‹©Cç»„èœå“",trigger:"change"}]},c=O(()=>{if(!n.value?.pools)return{A:[],B:[],C:[]};const o=e=>[...e.map(a=>({label:a,value:a})),{label:"å…¶ä»–",value:"å…¶ä»–"}];return{A:o(n.value.pools.A),B:o(n.value.pools.B),C:o(n.value.pools.C)}}),d=b({A:"",B:"",C:""});function A(o){t.value.meals[o]==="å…¶ä»–"&&(d.value[o]="")}const t=b({date:U().format("YYYY-MM-DD"),meals:{A:null,B:null,C:null},note:""});async function $(){try{if(await B.value?.validate(),!t.value.meals.A||!t.value.meals.B||!t.value.meals.C){window.$message?.error("è¯·é€‰æ‹©æ‰€æœ‰èœå“");return}const o=e=>t.value.meals[e]==="å…¶ä»–"?d.value[e]||"å…¶ä»–":t.value.meals[e];await y.createRecord({date:t.value.date,schemeId:n.value?.id||"",schemeName:n.value?.name||"æ‰‹åŠ¨è®°å½•",meals:{A:o("A"),B:o("B"),C:o("C")},note:t.value.note}),window.$message?.success("è®°å½•å·²ä¿å­˜"),S()}catch(o){console.log("è¡¨å•éªŒè¯å¤±è´¥:",o)}}function S(){t.value={date:U().format("YYYY-MM-DD"),meals:{A:null,B:null,C:null},note:""},d.value={A:"",B:"",C:""},B.value?.restoreValidation()}async function q(o){await y.deleteRecord(o),window.$message?.success("è®°å½•å·²åˆ é™¤")}return L(async()=>{await y.loadRecords(),await R.loadSchemes()}),(o,e)=>(r(),k("div",J,[e[16]||(e[16]=i("h1",null,"è®°å½•é¥®é£Ÿ ðŸ“",-1)),l(n)?(r(),m(l(V),{key:0,type:"info",style:{"margin-bottom":"1.5rem"}},{default:u(()=>[e[11]||(e[11]=v(" å½“å‰æ–¹æ¡ˆï¼š",-1)),i("strong",null,p(l(n).name),1),l(n).description?(r(),k(D,{key:0},[v(" - "+p(l(n).description),1)],64)):C("",!0)]),_:1})):(r(),m(l(V),{key:1,type:"warning",style:{"margin-bottom":"1.5rem"}},{default:u(()=>[...e[12]||(e[12]=[v(" æœªé€‰æ‹©æ–¹æ¡ˆï¼Œè¯·å…ˆåœ¨æ–¹æ¡ˆç®¡ç†ä¸­é€‰æ‹©ä¸€ä¸ªæ–¹æ¡ˆ ",-1)])]),_:1})),s(l(T),{ref_key:"formRef",ref:B,model:t.value,rules:I,"label-placement":"left","label-width":"100"},{default:u(()=>[s(l(f),{label:"è®°å½•æ—¥æœŸ",path:"date"},{default:u(()=>[s(l(Z),{"formatted-value":t.value.date,"onUpdate:formattedValue":e[0]||(e[0]=a=>t.value.date=a),"value-format":"yyyy-MM-dd",type:"date",placeholder:"é€‰æ‹©æ—¥æœŸ",style:{width:"100%"},clearable:""},null,8,["formatted-value"])]),_:1}),s(l(f),{label:"Aç»„èœå“",path:"meals.A"},{default:u(()=>[s(l(N),{value:t.value.meals.A,"onUpdate:value":[e[1]||(e[1]=a=>t.value.meals.A=a),e[2]||(e[2]=()=>A("A"))],options:c.value.A,placeholder:"è¯·é€‰æ‹©Aç»„èœå“",filterable:"",clearable:""},null,8,["value","options"]),t.value.meals.A==="å…¶ä»–"?(r(),m(l(g),{key:0,value:d.value.A,"onUpdate:value":e[3]||(e[3]=a=>d.value.A=a),placeholder:"è¯·è¾“å…¥è‡ªå®šä¹‰èœå“åç§°",style:{"margin-top":"0.5rem"},clearable:""},null,8,["value"])):C("",!0)]),_:1}),s(l(f),{label:"Bç»„èœå“",path:"meals.B"},{default:u(()=>[s(l(N),{value:t.value.meals.B,"onUpdate:value":[e[4]||(e[4]=a=>t.value.meals.B=a),e[5]||(e[5]=()=>A("B"))],options:c.value.B,placeholder:"è¯·é€‰æ‹©Bç»„èœå“",filterable:"",clearable:""},null,8,["value","options"]),t.value.meals.B==="å…¶ä»–"?(r(),m(l(g),{key:0,value:d.value.B,"onUpdate:value":e[6]||(e[6]=a=>d.value.B=a),placeholder:"è¯·è¾“å…¥è‡ªå®šä¹‰èœå“åç§°",style:{"margin-top":"0.5rem"},clearable:""},null,8,["value"])):C("",!0)]),_:1}),s(l(f),{label:"Cç»„èœå“",path:"meals.C"},{default:u(()=>[s(l(N),{value:t.value.meals.C,"onUpdate:value":[e[7]||(e[7]=a=>t.value.meals.C=a),e[8]||(e[8]=()=>A("C"))],options:c.value.C,placeholder:"è¯·é€‰æ‹©Cç»„èœå“",filterable:"",clearable:""},null,8,["value","options"]),t.value.meals.C==="å…¶ä»–"?(r(),m(l(g),{key:0,value:d.value.C,"onUpdate:value":e[9]||(e[9]=a=>d.value.C=a),placeholder:"è¯·è¾“å…¥è‡ªå®šä¹‰èœå“åç§°",style:{"margin-top":"0.5rem"},clearable:""},null,8,["value"])):C("",!0)]),_:1}),s(l(f),{label:"å¤‡æ³¨"},{default:u(()=>[s(l(g),{value:t.value.note,"onUpdate:value":e[10]||(e[10]=a=>t.value.note=a),type:"textarea",placeholder:"å¯é€‰å¤‡æ³¨",rows:3},null,8,["value"])]),_:1}),s(l(f),null,{default:u(()=>[s(l(G),null,{default:u(()=>[s(l(w),{type:"primary",loading:l(x),onClick:$},{default:u(()=>[...e[13]||(e[13]=[v(" ä¿å­˜è®°å½• ",-1)])]),_:1},8,["loading"]),s(l(w),{onClick:S},{default:u(()=>[...e[14]||(e[14]=[v(" é‡ç½®è¡¨å• ",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["model"]),s(l(_)),e[17]||(e[17]=i("h2",null,"æœ€è¿‘è®°å½•",-1)),l(M).length>0?(r(),m(l(z),{key:2},{default:u(()=>[(r(!0),k(D,null,j(l(M),a=>(r(),m(l(H),{key:a.id},{default:u(()=>[i("div",K,[i("span",W,p(a.date),1),i("span",X," A: "+p(a.meals.A)+" | B: "+p(a.meals.B)+" | C: "+p(a.meals.C),1),s(l(w),{size:"small",type:"error",onClick:ae=>q(a.id)},{default:u(()=>[...e[15]||(e[15]=[v("åˆ é™¤",-1)])]),_:1},8,["onClick"])])]),_:2},1024))),128))]),_:1})):(r(),m(l(Q),{key:3,description:"æš‚æ— è®°å½•"}))]))}}),ne=E(ee,[["__scopeId","data-v-a57a6783"]]);export{ne as default};
